---
layout: post
title: MongoDB 모니터링 명령어
category: [mongodb]
tags: [mongodb]
redirect_from:
  - /2021/02/01/
---

- **mongostat**
```sql
mongostat 5 -i -h 192.168.0.100,192.168.0.101,192.168.0.102
```

- **mongotop**
```sql
mongostat 5 -h 192.168.0.100,192.168.0.101,192.168.0.102
```

- **Connection 조회**
```sql
rs:PRIMARY> db.serverStatus().connections
{ "current" : 2729, "available" : 49699, "totalCreated" : 199295 }
```

```
connections.current  
클라이언트에서 데이터베이스 서버로 들어오는 연결 수. 이 번호에는 현재 셸 세션이 포함됩니다. 이 데이텀에 더 많은 컨텍스트를 추가하려면 connections.available 값을 고려하십시오.
이 값에는 복제 세트 구성원 또는 mongos 인스턴스와 같은 다른 서버의 연결 또는 쉘 연결을 포함한 모든 수신 연결이 포함됩니다.

connections.available  
사용 가능한 사용되지 않은 수신 연결 수입니다.   
이 값을 connections.current 값과 결합하여 데이터베이스의 연결로드를 이해하고 사용 가능한 연결의 시스템 임계 값에 대한 자세한 정보는 UNIX ulimit 설정 문서를 고려하십시오.

connections.totalCreated     
서버에 작성된 모든 수신 연결의 수입니다. 이 숫자에는 이후 닫힌 연결이 포함됩니다.
```

- **IP별 Connection 조회**
```shell script
mongo 접속 
$ mongo --port 20001

rs10:PRIMARY> db.currentOp(true).inprog.reduce(
                (accumulator, connection) => {
                    ipaddress = connection.client ? connection.client.split(":")[0] : "unknown";
                    accumulator[ipaddress] = (accumulator[ipaddress] || 0) + 1;
                    accumulator["TOTAL_CONNECTION_COUNT"]++;
                    return accumulator;
                },
                { TOTAL_CONNECTION_COUNT: 0 }
            )
```