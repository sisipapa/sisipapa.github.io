---
layout: post
title: (MSA)3.auth ëª¨ë“ˆê°œë°œ
category: [Auth]
tags: [Auth, Spring Security, JWT]
redirect_from:

- /2025/04/15/

---
# Spring Boot JWT ì¸ì¦ ì„œë²„ êµ¬ì„±í•˜ê¸° (Hexagonal Architecture + MySQL)

ì´ë²ˆ ê¸€ì—ì„œëŠ” `Spring Boot` ê¸°ë°˜ìœ¼ë¡œ **JWT ì¸ì¦ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•**ì„ ì •ë¦¬í•©ë‹ˆë‹¤.  
ì•„í‚¤í…ì²˜ëŠ” **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(Hexagonal Architecture)** íŒ¨í„´ì„ ë”°ë¥´ë©°, DBëŠ” `MySQL`, ë¹Œë“œ ë„êµ¬ëŠ” `Gradle`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì´ êµ¬ì¡°ëŠ” í™•ì¥ì„±ê³¼ í…ŒìŠ¤íŠ¸ í¸ì˜ì„±ì´ ë›°ì–´ë‚˜ë©°, ë„ë©”ì¸ â†’ ìœ ìŠ¤ì¼€ì´ìŠ¤ â†’ ì–´ëŒ‘í„°ë¡œ íë¦„ì´ ê¹”ë”í•˜ê²Œ ë‚˜ë‰˜ì–´ ìœ ì§€ë³´ìˆ˜ê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.

---

## ğŸ“¦ íŒ¨í‚¤ì§€ êµ¬ì¡°

```bash
com.enjoywalk.auth
â”‚
â”œâ”€â”€ application                  # ìœ ìŠ¤ì¼€ì´ìŠ¤ ê³„ì¸µ
â”‚   â”œâ”€â”€ port
â”‚   â”‚   â”œâ”€â”€ in                   # ìœ ìŠ¤ì¼€ì´ìŠ¤ ì…ë ¥ (ex. ë¡œê·¸ì¸ ìš”ì²­)
â”‚   â”‚   â””â”€â”€ out                  # ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¶œë ¥ (ex. ìœ ì € ì¡°íšŒ, í† í° ì €ì¥)
â”‚   â””â”€â”€ service                  # ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„
â”‚
â”œâ”€â”€ domain                       # ë„ë©”ì¸ ê³„ì¸µ
â”‚   â”œâ”€â”€ model                    # ìˆœìˆ˜ ë„ë©”ì¸ ê°ì²´ (User, Token ë“±)
â”‚   â””â”€â”€ service                  # ë„ë©”ì¸ ê·œì¹™/ì •ì±… ì²˜ë¦¬
â”‚
â”œâ”€â”€ adapter
â”‚   â”œâ”€â”€ in
â”‚   â”‚   â””â”€â”€ web                  # REST ì»¨íŠ¸ë¡¤ëŸ¬ (Spring MVC)
â”‚   â””â”€â”€ out
â”‚       â”œâ”€â”€ persistence          # JPA Repository ë° DB ì–´ëŒ‘í„°
â”‚       â””â”€â”€ external             # ì™¸ë¶€ ì‹œìŠ¤í…œ (ex. ì´ë©”ì¼, OAuth2 provider ë“±)
â”‚
â”œâ”€â”€ config                       # ë³´ì•ˆ, JPA, CORS ë“± ì„¤ì •
â”‚   â”œâ”€â”€ JwtConfig.java
â”‚   â””â”€â”€ SecurityConfig.java
â”‚
â””â”€â”€ AuthApplication.java         # ë©”ì¸ í´ë˜ìŠ¤
```

âš™ï¸ Gradle ì„¤ì • (build.gradle)
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot'
    id 'io.spring.dependency-management'
}

dependencies {
    implementation project(':common') // common ëª¨ë“ˆ ì˜ì¡´ì„± ì¶”ê°€
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5' // JSON ì²˜ë¦¬ìš©
}
```

ğŸ› ï¸ application.yml ì„¤ì •
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/authdb?useSSL=false&serverTimezone=UTC
    username: your_db_user
    password: your_db_password
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
    database-platform: org.hibernate.dialect.MySQL8Dialect

  servlet:
    multipart:
      enabled: true

server:
  port: 8080

jwt:
  secret: your-256-bit-secret
  expiration: 3600000 # 1 hour
```

âœ… logback-spring.xml ì„¤ì • ì˜ˆì‹œ
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- ì½˜ì†” ì¶œë ¥ìš© íŒ¨í„´ -->
    <property name="CONSOLE_LOG_PATTERN"
              value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"/>

    <!-- ë¡œê·¸ íŒŒì¼ ê²½ë¡œ -->
    <property name="LOG_PATH" value="logs"/>

    <!-- ì½˜ì†” ì¶œë ¥ -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- íŒŒì¼ ì¶œë ¥ -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_PATH}/application.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${LOG_PATH}/application.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>14</maxHistory>
        </rollingPolicy>

        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- Hibernate SQL ë¡œê·¸ìš© ë³„ë„ ì„¤ì • (SQLì€ ë§ì´ ë‚˜ì˜¤ë‹ˆ infoë¡œ í•„í„°ë§) -->
    <logger name="org.hibernate.SQL" level="DEBUG"/>
    <logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="TRACE"/>

    <!-- Spring / Application ë¡œê·¸ ë ˆë²¨ -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>

</configuration>
```

ğŸ” JwtConfig í´ë˜ìŠ¤ (JWT ì„¤ì • ë°”ì¸ë”©)
```java
@Configuration
@ConfigurationProperties(prefix = "jwt")
public class JwtConfig {
    private String secret;
    private long expiration;

    // Getters and Setters
}
```

ğŸ” Spring Security ì„¤ì • (SecurityConfig)
```java
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    private final JwtTokenFilter jwtTokenFilter;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf().disable()
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/auth/**").permitAll()
                .anyRequest().authenticated()
            )
            .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .addFilterBefore(jwtTokenFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
```

ğŸ” êµ¬ì„± íë¦„ ìš”ì•½
```text
[Request] 
   â†’ Adapter In (Web: Controller)
      â†’ Application Port In (UseCase Interface)
         â†’ Application Service (ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ì²´)
            â†’ Domain Model / Domain Service
            â†’ Application Port Out (Repository Interface)
               â†’ Adapter Out (JPA, ì™¸ë¶€ API ë“±)

```

