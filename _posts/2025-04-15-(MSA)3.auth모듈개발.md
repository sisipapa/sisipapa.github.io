---
layout: post
title: (MSA)3.auth ëª¨ë“ˆê°œë°œ
category: [Auth]
tags: [Auth, Spring Security, JWT]
redirect_from:

- /2025/04/15/

---
# Spring Boot JWT ì¸ì¦ ì„œë²„ êµ¬ì„±í•˜ê¸° (Hexagonal Architecture + MySQL)

ì´ë²ˆ ê¸€ì—ì„œëŠ” `Spring Boot` ê¸°ë°˜ìœ¼ë¡œ **JWT ì¸ì¦ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•**ì„ ì •ë¦¬í•©ë‹ˆë‹¤.  
ì•„í‚¤í…ì²˜ëŠ” **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(Hexagonal Architecture)** íŒ¨í„´ì„ ë”°ë¥´ë©°, DBëŠ” `MySQL`, ë¹Œë“œ ë„êµ¬ëŠ” `Gradle`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì´ êµ¬ì¡°ëŠ” í™•ì¥ì„±ê³¼ í…ŒìŠ¤íŠ¸ í¸ì˜ì„±ì´ ë›°ì–´ë‚˜ë©°, ë„ë©”ì¸ â†’ ìœ ìŠ¤ì¼€ì´ìŠ¤ â†’ ì–´ëŒ‘í„°ë¡œ íë¦„ì´ ê¹”ë”í•˜ê²Œ ë‚˜ë‰˜ì–´ ìœ ì§€ë³´ìˆ˜ê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.

---

## ğŸ“¦ íŒ¨í‚¤ì§€ êµ¬ì¡°

```bash
com.enjoywalk.auth
â”‚
â”œâ”€â”€ adapter                        # ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ì—°ê²° (ì…ë ¥/ì¶œë ¥ ì–´ëŒ‘í„°)
â”‚   â”œâ”€â”€ in                         # ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ ì²˜ë¦¬ (ex. Controller)
â”‚   â”‚   â””â”€â”€ web                    # REST API ì»¨íŠ¸ë¡¤ëŸ¬ ìœ„ì¹˜
â”‚   â”‚       â””â”€â”€ mapper             # Request/Response <-> DTO ë³€í™˜ìš© ë§¤í¼
â”‚   â””â”€â”€ out                        # ì™¸ë¶€ë¡œ ë‚˜ê°€ëŠ” ì²˜ë¦¬ (DB, ì™¸ë¶€ API ë“±)
â”‚       â””â”€â”€ persistence            # ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì–´ëŒ‘í„°
â”‚           â”œâ”€â”€ entity             # JPA ì—”í‹°í‹° í´ë˜ìŠ¤
â”‚           â””â”€â”€ mapper             # Entity <-> Domain ëª¨ë¸ ë§¤í•‘
â”‚
â”œâ”€â”€ application                    # ìœ ìŠ¤ì¼€ì´ìŠ¤ ê³„ì¸µ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ íë¦„ ì²˜ë¦¬)
â”‚   â”œâ”€â”€ port                       # ì˜ì¡´ì„± ì—­ì „ ì§€ì  (ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜)
â”‚   â”‚   â”œâ”€â”€ in                     # ìœ ìŠ¤ì¼€ì´ìŠ¤ ì…ë ¥ í¬íŠ¸ (ex. ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤)
â”‚   â”‚   â””â”€â”€ out                    # ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¶œë ¥ í¬íŠ¸ (ex. DB í˜¸ì¶œ ì¸í„°í˜ì´ìŠ¤)
â”‚   â””â”€â”€ service                    # ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ì²´ (ë¹„ì¦ˆë‹ˆìŠ¤ íë¦„ ë‹´ë‹¹)
â”‚
â”œâ”€â”€ domain                         # ë„ë©”ì¸ ê³„ì¸µ (í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ê³¼ ë¡œì§)
â”‚   â”œâ”€â”€ model                      # ë„ë©”ì¸ ëª¨ë¸ (ex. Member, Token ë“±)
â”‚   â””â”€â”€ service                    # ë„ë©”ì¸ ì •ì±…/ë¡œì§ ì²˜ë¦¬ (ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚
â”œâ”€â”€ infrastructure                # ê¸°ìˆ ì  ì„¸ë¶€ êµ¬í˜„ (ë³´ì•ˆ, ì„¤ì •, JWT ë“±)
â”‚   â”œâ”€â”€ config                     # ë³´ì•ˆ ì„¤ì •, CORS, Bean ì„¤ì • ë“±
â”‚   â”œâ”€â”€ filter                     # ì»¤ìŠ¤í…€ í•„í„° (ex. JWT ì¸ì¦ í•„í„°)
â”‚   â””â”€â”€ jwt                        # JWT í† í° ìƒì„± ë° ê²€ì¦ ë¡œì§
â”‚
â””â”€â”€ AuthApplication.java           # ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¸ ì‹¤í–‰ í´ë˜ìŠ¤
```
### ì„¤ëª…
- `mapper` íŒ¨í‚¤ì§€ê°€ `adapter`ì˜ in/out êµ¬ê°„ì—ì„œ ê°ê°ì˜ íŒ¨í‚¤ì§€ë¡œ êµ¬ë¶„ë˜ë„ë¡ êµ¬ì„±
- `infrastructure` íŒ¨í‚¤ì§€ ì¶”ê°€í•´ì„œ ê¸°ìˆ ì  ì„¸ë¶€ êµ¬í˜„ì„ ë¶„ë¦¬

âš™ï¸ Gradle ì„¤ì • (build.gradle)
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot'
    id 'io.spring.dependency-management'
}

dependencies {
    implementation project(':common') // common ëª¨ë“ˆ ì˜ì¡´ì„± ì¶”ê°€
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5' // JSON ì²˜ë¦¬ìš©
}
```

ğŸ› ï¸ application.yml ì„¤ì •
```yaml
spring:
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password:
  h2:
    console:
      enabled: true
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  sql:
    init:
      mode: always
      schema-locations: classpath:h2\schema.sql

decorator:
  datasource:
    p6spy:
      enable-logging: false  # H2ì¼ ë• P6Spy êµ³ì´ ëŒ ìˆ˜ë„ ìˆì–´ìš”

jwt:
  secret: "4c6Vb@tLq9kZ$J6sB3rU^7u8yA0M2tX2b3LzJ1tQG9y1kB5aV&yP7sVn3zB8xW"
  expiration: 86400000
```

âœ… logback-spring.xml ì„¤ì • ì˜ˆì‹œ
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>

  <!-- ì½˜ì†” ì¶œë ¥ -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
    </encoder>
  </appender>

  <!-- P6Spy SQL ë¡œê·¸ ì „ìš© ë¡œê±° -->
  <logger name="p6spy" level="DEBUG" additivity="false">
    <appender-ref ref="CONSOLE"/>
  </logger>

  <!-- ì „ì²´ ë£¨íŠ¸ ë¡œê·¸ -->
  <root level="INFO">
    <appender-ref ref="CONSOLE"/>
  </root>

</configuration>
```

ğŸ” Spring Security ì„¤ì • (SecurityConfig)
```java
package com.enjoywalk.auth.infrastructure.config;

import com.enjoywalk.auth.infrastructure.filter.JwtAuthenticationFilter;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
                .csrf(AbstractHttpConfigurer::disable) // CSRF ë¹„í™œì„±í™”
                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(auth -> auth.anyRequest().permitAll())
                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class) // ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ JWT ì¸ì¦ í•„í„° ì¶”ê°€
                .build();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

ğŸ” êµ¬ì„± íë¦„ ìš”ì•½
```text
[Request] 
   â†’ Adapter In (Web: Controller)
      â†’ Application Port In (UseCase Interface)
         â†’ Application Service (ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ì²´)
            â†’ Domain Model / Domain Service
            â†’ Application Port Out (Repository Interface)
               â†’ Adapter Out (JPA, ì™¸ë¶€ API ë“±)

```

