---
layout: post 
title: QueryDsl 정리
category: [JPA]
tags: [JPA, QueryDsl]
redirect_from:

- /2021/04/15/

---
## JpaRepository 구현체 없이 JPAQueryFactory 사용하기  
이 방법은 우아한테크? 유튜브 영상을 보고 배운 방법이다.  
필요하지 않은 JpaRepository Interface를 생성하지 않고 JPAQueryFactory를 Bean으로 등록하고 Repository에서 바로 사용하는 방법이다.    
```java  
package com.sisipapa.study3.config;

import com.querydsl.jpa.impl.JPAQueryFactory;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

@Configuration
public class QuerydslConfig {

    @PersistenceContext
    private EntityManager entityManager;

    @Bean
    public JPAQueryFactory jpaQueryFactory() {
        return new JPAQueryFactory(entityManager);
    }
}
```  
```java  
@Repository
@AllArgsConstructor
public class OrderQueryDslRepository  {

    private final JPAQueryFactory queryFactory;
    
}
```

## 검색어로 테이블 조회  
파라미터로 받은 OrderSearch 객체의 searchWord를 조회조건으로 테이블 검색   
```java  
public List<Order> findAllByString(OrderSearch orderSearch) {

    BooleanBuilder builder = new BooleanBuilder();
    builder.and(order.orderName.eq(orderSearch.getSearchWord()));

    JPQLQuery<Order> query = queryFactory
                                .selectFrom(order)
                                .where(builder);
    
    List<Order> list = query.fetch();
    return list;
}
```  
  
## 테이블 Join 및 Projections를 활용한 특정필드 조회 Alias 적용  
```java  
public List<OrderSimpleQueryDto> findOrderDto() {

//		return getEntityManager().createQuery("select new kr.sskm.dto.OrderSimpleQueryDto(o.id, m.name, o.orderDate, o.status, d.address) from Order o"
//									 + " join o.member m"
//									 + " join o.delivery d", OrderSimpleQueryDto.class)
//				.getResultList();

    JPAQuery<Order> query = queryFactory.selectFrom(order)
                                .innerJoin(order.member, member)
                                .innerJoin(order.delivery, delivery);

    List<OrderSimpleQueryDto> list = query.select(Projections.fields(OrderSimpleQueryDto.class,
                                                                    ExpressionUtils.as(order.id, "orderId"),
                                                                    member.name,
                                                                    order.orderDate,
                                                                    ExpressionUtils.as(order.status, "orderStatus"),
                                                                    order.delivery.address)).fetch();
    return list;

}
```  


## Github
<https://github.com/sisipapa/jpa-querydsl.git>  
  
## 참고  
[인프런 강의 - 실전! 스프링 부트와 JPA 활용2 - API 개발과 성능 최적화](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94/dashboard)

   