---
layout: post
title: MongoDB 조회쿼리 정리[작성중]
category: [mongodb]
tags: [mongodb]
redirect_from:
  - /2021/01/11/
---

- **범위조회**

```sql
SELECT 
  AColumn,BColumn 
FROM collection 
WHERE last_update_datetime BETWEEN '2020-01-01T00:00:00.000Z' AND '2020-12-30T00:00:00.000Z'
```

```sql
db.collection.find({$and:
  [
    {last_update_datetime:{$gte:ISODate("2020-01-01T00:00:00.000Z")}},
     {last_update_datetime:{$lte:ISODate("2020-12-30T00:00:00.000Z")}}
   ]
 },{AColumn:1, BColumn:1})
```
- **Mongo aggregate Multiple Group by**

```sql
SELECT 
  collDate, targetType, PC_COUNT, MOBILE_COUNT, UNKNOWN_COUNT, TOTAL_COUNT
FROM collection 
WHERE collDate = '20191119'
limit 3
GROUP BY collDate,targetType
```

```sql
db.statsTargetContain.aggregate([
    {
        '$match' : {'collDate' : {'$eq' : '20191119'}}
    },
    {
        '$limit' : 3
    },
    {
        '$group' : {
            '_id' : {
                'collDate' : '$collDate',
                'targetType' : '$targetType'
            },
            'PC_COUNT' : {'$sum':'$PC'},
            'MOBILE_COUNT' : {'$sum':'$MOBILE'},
            'TOTAL_COUNT' : {'$sum':'$TOTAL'}
        }

    }
])
```
- **Mongo field 목록조회**  
데이터가 많을 경우 limit를 걸어서 조회

```sql
var allKeys = {}; 
db.collection.find().limit(30000).forEach(
	function(doc){
		Object.keys(doc).forEach(
			function(key){
				allKeys[key]=1
			}
		)
	}
); 
allKeys;
```