---
layout: post 
title: MongoDB 조회쿼리 정리2
category: [mongodb]
tags: [mongodb]
redirect_from:

- /2021/09/07/

---

업무에서 간단한 검색어 검색이나 카운트 조회를 할 때는 find를 사용하지만 쿼리 중 grouping, filtering이 들어가게 되면 find로는 처리를 할 수가 없다. 그래서 오늘은 평소에 많이 사용하고 있는 Aggregation Framework Pipeline의 예제들과 정리를 해보려고 한다.    

## Aggregation  
- MongoDB의 Aggregation은 Sharding 기반의 데이터를 효율적으로 처리하고 집계하는 프레임워크이다.
- documents를 grouping, filtering 등 다양한 연산을 적용하여 계산된 결과를 반환한다.

## $match
### $eq
```json
db.getCollection('CIData_00').aggregate([
    {
        '$match' : {
            _id : {'$eq' : '540a4c8705273b05-306f3a1d163f2ba6641-7f3f'}
        }
    }
])
```

### $ne
```json
db.getCollection('CIData_00').aggregate([
    {
        '$match' : {
            _id : {'$ne' : '540a4c8705273b05-306f3a1d163f2ba6641-7f3f'}
        }
    }
])
```  

### $in
```json
db.getCollection('CIData_00').aggregate([
    {
        '$match' : {
            _id : {'$in' : ['540a4c8705273b05-306f3a1d163f2ba6641-7f3f','b776f5c16d3eaa8266a6f4f31737e25768b-3219']}
        }
    }
])
```  

### $nin
```json
db.getCollection('CIData_00').aggregate([
    {
        '$match' : {
            _id : {'$nin' : ['540a4c8705273b05-306f3a1d163f2ba6641-7f3f','b776f5c16d3eaa8266a6f4f31737e25768b-3219']}
        }
    }
])
```  

### $limit
```json
db.getCollection('CIData_00').aggregate([
    {
        '$match' : {
            _id : {'$nin' : ['540a4c8705273b05-306f3a1d163f2ba6641-7f3f','b776f5c16d3eaa8266a6f4f31737e25768b-3219']}
        }
    },
   {
     '$limit' : 5
   }
])
```  

### $and
```json
db.getCollection('CIData_00').aggregate([
  {
    '$match' : {
      '$and' : [
        {_id : {'$nin' : ['540a4c8705273b05-306f3a1d163f2ba6641-7f3f','b776f5c16d3eaa8266a6f4f31737e25768b-3219']}}
       ,{'key' : '000108f3c0db54c9-290fb41a165787def261e9d'}
      ]
    }
  }
])

// between A and B - 검색 조건 필드의 type이 date인 경우
db.getCollection('CIData_00').aggregate([
  {
    '$match' : {
      '$and' : [
        {'last_update_datetime' : {'$gt' : ISODate('2021-09-01T00:00:00Z')}}
      ,{'last_update_datetime' : {'$lt' : ISODate('2021-09-06T00:00:00Z')}}
      ]
    }
  }
])

// between A and B - 검색 조건 필드의 type이 String인 경우
db.getCollection('CIData_00').aggregate([
  {
    '$match' : {
      '$and' : [
        {'iUm.data.insDate' : {'$gt' : '20210901'}}
      ,{'iUm.data.insDate' : {'$lt' : '20210906'}}
      ]
    }
  }
])
```


